{"is_source_file": true, "format": "Python", "description": "This file defines API routes for managing driver profiles, including retrieving, updating, and listing drivers. It uses FastAPI, SQLAlchemy ORM models, and includes logic for proximity filtering with the Haversine formula.", "external_files": ["src.api.db", "src.api.deps", "src.api.models.driver", "src.api.models.user", "src.api.schemas.driver"], "external_methods": ["get_db", "require_driver"], "published": ["get_my_driver_profile", "upsert_my_driver_profile", "update_my_availability", "update_my_location", "list_available_drivers"], "classes": [], "methods": [{"name": "datetime _utcnow()", "description": "Returns the current UTC-aware datetime.", "scope": "", "scopeKind": ""}, {"name": "DriverPublic _to_public(d: Driver)", "description": "Converts a Driver ORM object to DriverPublic schema for API responses.", "scope": "", "scopeKind": ""}, {"name": "None _validate_proximity_args(lat: Optional[float], lng: Optional[float], radius_km: Optional[float])", "description": "Validates that proximity-related query parameters (lat, lng, radius_km) are provided correctly and consistently.", "scope": "", "scopeKind": ""}, {"name": "float _distance_km_haversine(lat1: float, lng1: float, lat2: float, lng2: float)", "description": "Calculates the Haversine distance in kilometers between two latitude/longitude points.", "scope": "", "scopeKind": ""}, {"name": "DriverPublic get_my_driver_profile( current_user: User = Depends(require_driver), db: Session = Depends(get_db), )", "description": "API endpoint to retrieve current authenticated driver's profile.", "scope": "", "scopeKind": ""}, {"name": "DriverPublic upsert_my_driver_profile( payload: DriverProfileUpsert, current_user: User = Depends(require_driver), db: Session = Depends(get_db), )", "description": "API endpoint to create or update the authenticated driver's profile.", "scope": "", "scopeKind": ""}, {"name": "DriverPublic update_my_availability( payload: DriverAvailabilityUpdate, current_user: User = Depends(require_driver), db: Session = Depends(get_db), )", "description": "API endpoint to update the current driver's availability status.", "scope": "", "scopeKind": ""}, {"name": "DriverPublic update_my_location( payload: DriverLocationUpdate, current_user: User = Depends(require_driver), db: Session = Depends(get_db), )", "description": "API endpoint to update the current driver's location.", "scope": "", "scopeKind": ""}, {"name": "List[DriverPublic] list_available_drivers( lat: Optional[float] = Query(default=None, ge=-90, le=90, description=\"Filter center latitude.\"), lng: Optional[float] = Query(default=None, ge=-180, le=180, description=\"Filter center longitude.\"), radius_km: Optional[float] = Query( default=None, gt=0, le=200, description=\"Radius in kilometers (max 200km) for proximity filtering.\", ), db: Session = Depends(get_db), )", "description": "API endpoint to list all available drivers, with optional proximity filtering.", "scope": "", "scopeKind": ""}], "calls": ["select(Driver).where(Driver.id == current_user.id)", "select(Driver).where(Driver.is_available.is_(True))", "select(Driver).where(and_(Driver.location_lat.is_not(None), Driver.location_lng.is_not(None)))", "db.scalars(stmt).all()", "_distance_km_haversine(lat, lng, float(d.location_lat), float(d.location_lng))"], "search-terms": ["driver profile", "proximity filtering", "Haversine distance", "available drivers", "driver location", "driver availability", "FastAPI", "SQLAlchemy ORM"], "state": 2, "file_id": 19, "knowledge_revision": 40, "git_revision": "23b82ba9e8b2c4e5c12af7076dacb93007e4e990", "ctags": [{"_type": "tag", "name": "_distance_km_haversine", "path": "/home/kavia/workspace/code-generation/rideconnect-201071-201080/taxi_backend/src/api/routers/drivers.py", "pattern": "/^def _distance_km_haversine(lat1: float, lng1: float, lat2: float, lng2: float) -> float:$/", "language": "Python", "typeref": "typename:float", "kind": "function", "signature": "(lat1: float, lng1: float, lat2: float, lng2: float)"}, {"_type": "tag", "name": "_to_public", "path": "/home/kavia/workspace/code-generation/rideconnect-201071-201080/taxi_backend/src/api/routers/drivers.py", "pattern": "/^def _to_public(d: Driver) -> DriverPublic:$/", "language": "Python", "typeref": "typename:DriverPublic", "kind": "function", "signature": "(d: Driver)"}, {"_type": "tag", "name": "_utcnow", "path": "/home/kavia/workspace/code-generation/rideconnect-201071-201080/taxi_backend/src/api/routers/drivers.py", "pattern": "/^def _utcnow() -> datetime:$/", "language": "Python", "typeref": "typename:datetime", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_validate_proximity_args", "path": "/home/kavia/workspace/code-generation/rideconnect-201071-201080/taxi_backend/src/api/routers/drivers.py", "pattern": "/^def _validate_proximity_args(lat: Optional[float], lng: Optional[float], radius_km: Optional[flo/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(lat: Optional[float], lng: Optional[float], radius_km: Optional[float])"}, {"_type": "tag", "name": "get_my_driver_profile", "path": "/home/kavia/workspace/code-generation/rideconnect-201071-201080/taxi_backend/src/api/routers/drivers.py", "pattern": "/^def get_my_driver_profile($/", "language": "Python", "typeref": "typename:DriverPublic", "kind": "function", "signature": "( current_user: User = Depends(require_driver), db: Session = Depends(get_db), )"}, {"_type": "tag", "name": "list_available_drivers", "path": "/home/kavia/workspace/code-generation/rideconnect-201071-201080/taxi_backend/src/api/routers/drivers.py", "pattern": "/^def list_available_drivers($/", "language": "Python", "typeref": "typename:List[DriverPublic]", "kind": "function", "signature": "( lat: Optional[float] = Query(default=None, ge=-90, le=90, description=\"Filter center latitude.\"), lng: Optional[float] = Query(default=None, ge=-180, le=180, description=\"Filter center longitude.\"), radius_km: Optional[float] = Query( default=None, gt=0, le=200, description=\"Radius in kilometers (max 200km) for proximity filtering.\", ), db: Session = Depends(get_db), )"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/rideconnect-201071-201080/taxi_backend/src/api/routers/drivers.py", "pattern": "/^router = APIRouter(prefix=\"\\/drivers\", tags=[\"drivers\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "update_my_availability", "path": "/home/kavia/workspace/code-generation/rideconnect-201071-201080/taxi_backend/src/api/routers/drivers.py", "pattern": "/^def update_my_availability($/", "language": "Python", "typeref": "typename:DriverPublic", "kind": "function", "signature": "( payload: DriverAvailabilityUpdate, current_user: User = Depends(require_driver), db: Session = Depends(get_db), )"}, {"_type": "tag", "name": "update_my_location", "path": "/home/kavia/workspace/code-generation/rideconnect-201071-201080/taxi_backend/src/api/routers/drivers.py", "pattern": "/^def update_my_location($/", "language": "Python", "typeref": "typename:DriverPublic", "kind": "function", "signature": "( payload: DriverLocationUpdate, current_user: User = Depends(require_driver), db: Session = Depends(get_db), )"}, {"_type": "tag", "name": "upsert_my_driver_profile", "path": "/home/kavia/workspace/code-generation/rideconnect-201071-201080/taxi_backend/src/api/routers/drivers.py", "pattern": "/^def upsert_my_driver_profile($/", "language": "Python", "typeref": "typename:DriverPublic", "kind": "function", "signature": "( payload: DriverProfileUpsert, current_user: User = Depends(require_driver), db: Session = Depends(get_db), )"}], "hash": "cf42e0d8ea24623eec3db37c752b4033", "format-version": 4, "code-base-name": "taxi_backend", "filename": "taxi_backend/src/api/routers/drivers.py", "fields": [{"name": "router = APIRouter(prefix=\"\\/drivers\", tags=[\"drivers\"])", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"40": "23b82ba9e8b2c4e5c12af7076dacb93007e4e990"}]}